require(tinytex)
setwd("C:/Users/rver4657/Dropbox (Sydney Uni)/Research/Forest_and_water/paper/Forest_and_Water")
require(tidyverse)
require(lubridate)
require(mgcv)
require(visreg)
require(patchwork)
suppressWarnings(require(knitr))
suppressWarnings(require(bookdown))
suppressWarnings(require(pander))
Zhang_small <- read_csv("../../data/TablesZhangetal2017_small.csv")
Zhang_large <- read_csv("../../data/TablesZhangetal2017_large.csv") %>%
mutate(Complete = 1,
`Possible duplicate` = 0)
new_data <- read_csv("../../data/TableNewData.csv")
PET_large <- read_csv("../../data/largeET.csv")
PET_small <- read_csv("../../data/smallET.csv")
# drop columns and make sure the titles are the same
PET_large <- PET_large %>%
rename(Latitude = Latitiude,
E0 = rvalue_1,
`Watershed #` = Watershed)
PET_small <- PET_small %>%
select(site_name, lat, long, rvalue_1) %>%
rename(Latitude = lat,
Longitude = long,
`Watershed #` = site_name,
E0 = rvalue_1)
#
PET_all <- bind_rows(PET_large, PET_small)
# There are 7 missing E0 values
# > PET_all$`Watershed #`[is.na(PET_all$E0)==T]
# [1]  38 278 269 243 236 299 250
names(Zhang_small)[3:4] <- c("Area_km2", "Pa_mm")
names(Zhang_large)[3:4] <- c("Area_km2", "Pa_mm")
names(new_data)[3:4] <- c("Area_km2", "Pa_mm")
names(Zhang_small)[5:6] <- c("Forest_type", "Hydrological_regime")
names(Zhang_large)[5:6] <- c("Forest_type", "Hydrological_regime")
names(new_data)[5:6] <- c("Forest_type", "Hydrological_regime")
names(Zhang_small)[9:10] <- c("Precip_data_type", "Assessment_technique")
names(Zhang_large)[9:10] <- c("Precip_data_type", "Assessment_technique")
names(new_data)[9:10] <- c("Precip_data_type", "Assessment_technique")
Zhang_small$From <- as.numeric(Zhang_small$From)
Zhang_small$To <- as.numeric(Zhang_small$To)
Zhang_all <- bind_rows(Zhang_large,Zhang_small) %>%
mutate(dataset = "original Zhang et al data")
new_data <- new_data %>%
mutate(dataset = "new data")
All_data <- bind_rows(Zhang_all, new_data)
All_data <- All_data %>%
mutate(`Possible duplicate` =
ifelse(is.na(`Possible duplicate`)==T,0,`Possible duplicate`),
`Possible duplicate` = as.numeric(`Possible duplicate`)) %>%
filter(`Possible duplicate` != 1)
All_data <- left_join(All_data ,PET_all %>% select(-c(Longitude, Latitude)), by = "Watershed #")
All_data <- All_data %>%
mutate(E0 = ifelse(is.na(E0.x)==T, E0.y, E0.x)) %>%
select(-c(E0.x,E0.y)) #%>%
#rename(Latitude = Latitude.x,
#         Longitude = Longitude.x)
# calculate dryness index
All_data <- All_data %>%
mutate(Dryness = E0/Pa_mm)
All_data <- All_data %>%
filter(`Watershed #` != 1)
All_data <- All_data %>%
mutate(DeltaQf_perc = ifelse(`Watershed #` == 76,157,DeltaQf_perc))
All_data2 <- All_data2 %>%
mutate(length = To - From)
All_data2 <- All_data %>%
mutate(Forest_Sign = ifelse(DeltaF_perc < 0,
"decrease", "increase"),
DeltaF_perc_pos = ifelse(DeltaF_perc < 0,
-1*DeltaF_perc,
DeltaF_perc))
All_data2 <- All_data2 %>%
mutate(length = To - From)
model4b <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign + To +
s(log10(Area_km2), bs="ts") + s(Dryness, bs="ts"),
data = All_data2)
summary(model4b)
#gam.check(model5_all)
#plot(model5_all)
All_data2 <- All_data2 %>%
mutate(length = To - From)
model4b <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign + To +
s(log10(Area_km2), bs="ts") + s(Dryness, bs="ts") +
s(length, bs = "ts"),
data = All_data2)
summary(model4b)
#gam.check(model5_all)
#plot(model5_all)
All_data2 <- All_data2 %>%
mutate(length = To - From)
model4b <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign + To +
s(log10(Area_km2), bs="ts") + s(Dryness, bs="ts") +
s(length, bs = "ts"),
data = All_data2 %>% filter(length < 60))
summary(model4b)
#gam.check(model5_all)
#plot(model5_all)
All_data2 <- All_data2 %>%
mutate(length = To - From)
model4b <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign + From +
s(log10(Area_km2), bs="ts") + s(Dryness, bs="ts") +
s(length, bs = "ts"),
data = All_data2 %>% filter(length < 60))
summary(model4b)
#gam.check(model5_all)
#plot(model5_all)
model7_nolongLength <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign +
s(Dryness, bs="ts" ) + #s(Latitude, bs="ts") +
s(log10(Area_km2), bs="ts") + s(length,bs="ts") + From +
Precip_data_type +  Assessment_technique + Forest_type +
Hydrological_regime, data = All_data2 %>% filter(length< 60))
#summary(model7_noLatb)
#plot(model7_noLatb)
#pander(round(summary(model7_nolongLength)$p.table,2))
#plot(model7_noLatb)
#summary(model7_nolongLength)
summary(model7_nolongLength)
model7_nolongLength <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign +
s(Dryness, bs="ts" ) + #s(Latitude, bs="ts") +
s(log10(Area_km2), bs="ts") + s(length,bs="ts") + s(From, bs="ts") +
Precip_data_type +  Assessment_technique + Forest_type +
Hydrological_regime, data = All_data2 %>% filter(length< 60))
summary(model7_nolongLength)
plot(model7_nolongLength)
model7_nolongLength <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign +
s(Dryness, bs="ts" ) + #s(Latitude, bs="ts") +
log10(Area_km2) + length + From +
Precip_data_type +  Assessment_technique + Forest_type +
Hydrological_regime, data = All_data2 %>% filter(length< 60))
summary(model7_nolongLength)
plot(model7_nolongLength)
All_data3 <- All_data2 %>%
filter(Assessment_technique != "EA, HM" & Assessment_technique != "PWE, HM" & Assessment_technique != "QPW, EA" )
model8_assess <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign +
s(Dryness, bs="ts" ) + #s(Latitude, bs="ts") +
log10(Area_km2) + length + From +
Precip_data_type +  Assessment_technique + Forest_type +
Hydrological_regime, data = All_data3 %>% filter(length< 60))
#summary(model7_noLatb)
#plot(model7_noLatb)
pander(round(summary(model8_assess)$p.table,2))
pander(round(summary(model8_assess)$s.table,2))
#plot(model8_assess)
#summary(model8_assess)
#plot(model8_assess)
summary(model8_assess)
model7_nolongLength <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign +
s(Dryness, bs="ts" ) + #s(Latitude, bs="ts") +
log10(Area_km2) + length +
Precip_data_type +  Assessment_technique:From + Forest_type +
Hydrological_regime, data = All_data2 %>% filter(length< 60))
summary(model7_nolongLength)
model7_nolongLength <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign +
s(Dryness, bs="ts" ) + #s(Latitude, bs="ts") +
log10(Area_km2) + length + From
Precip_data_type +  Assessment_technique + Forest_type +
model7_nolongLength <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign +
s(Dryness, bs="ts" ) + #s(Latitude, bs="ts") +
log10(Area_km2) + length + From +
Precip_data_type +  Assessment_technique + Forest_type +
Hydrological_regime, data = All_data2 %>% filter(length< 60))
summary(model7_nolongLength)
pander(round(summary(model7_nolongLength)$p.table,2), caption = "Statistical summary of the smooth terms reducing dataset to studies with the study length shorter than 60 years")
model7_nolongLength <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign +
s(Dryness, bs="ts" ) + #s(Latitude, bs="ts") +
s(log10(Area_km2), bs = "ts") + s(length, bs = "ts") + s(From, bs = "ts") +
Precip_data_type +  Assessment_technique + Forest_type +
Hydrological_regime, data = All_data2 %>% filter(length< 60))
summary(model7_nolongLength)
plot(model7_nolongLength)
model7_nolongLength <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign +
s(Dryness, bs="ts" ) + #s(Latitude, bs="ts") +
s(log10(Area_km2), bs = "ts") + s(length, bs = "ts") + s(From, bs = "ts") +
Precip_data_type +  Assessment_technique + Forest_type +
Hydrological_regime, data = All_data2 %>% filter(length< 60, Dryness <= 4))
summary(model7_nolongLength)
plot(model7_nolongLength)
#require(visreg)
png("model6_smooths.png", width = 2500, height = 1800, res = 300)
#par(mfrow=c(2,2))
D <- visreg(model6_all, "Dryness", gg = T, plot = T) + theme_bw()
model6_all <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign +
s(log10(Area_km2), bs="ts") + s(Dryness, bs="ts" ) +
s(length, bs="ts") + s(From, bs = "ts") +
Precip_data_type +  Assessment_technique + Forest_type +
Hydrological_regime
, data = All_data2)
#summary(model6_all)
#gam.check(model6_all)
#plot(model6_all)
pander(round(summary(model6_all)$p.table,2), caption = "Statistical summary for the linear terms the full model")
#plot(model6_all)
pander(round(summary(model6_all)$s.table,2), caption = "Statistical summary for the smooth terms for the full model")
#plot(model6_all)
#require(visreg)
png("model6_smooths.png", width = 2500, height = 1800, res = 300)
#par(mfrow=c(2,2))
D <- visreg(model6_all, "Dryness", gg = T, plot = T) + theme_bw()
A <- visreg(model6_all, "Area_km2", gg = T, plot = T) + theme_bw() + scale_x_log10()
L <- visreg(model6_all, "length", gg = T, plot = T) + theme_bw()
From <- visreg(model6_all, "From", gg = T, plot = T) + theme_bw()
(D + A) / (L + From)
# visreg(model6_all,"Dryness",gg=T) + theme_bw()
# visreg(model6_all,"length",gg=T, add=T) + theme_bw()
# visreg(model6_all,"Area_km2",gg=T, add=T) + theme_bw() + scale_x_log10()
#par(mfrow=c(1,1))
dev.off()
pander(round(summary(model7_nolongLength)$s.table,2), caption = "Statistical summary of the smooth terms reducing dataset to studies with the study length shorter than 60 years")
#require(visreg)
png("model7_smooths.png", width = 2500, height = 1800, res = 300)
#par(mfrow=c(2,2))
D <- visreg(model7_nolongLength, "Dryness", gg = T, plot = T) + theme_bw()
visreg(model7_nolongLength, "Dryness", gg = T, plot = T) + theme_bw()
model7_nolongLength
visreg(model7_nolongLength)
NoLong_Data <- All_data2 %>% filter(length< 60)
model7 <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign +
s(Dryness, bs="ts" ) + #s(Latitude, bs="ts") +
s(log10(Area_km2), bs = "ts") + s(length, bs = "ts") + s(From, bs = "ts") +
Precip_data_type +  Assessment_technique + Forest_type +
Hydrological_regime, data = NoLong_Data)
summary(model7)
pander(round(summary(model7_nolongLength)$s.table,2), caption = "Statistical summary of the smooth terms reducing dataset to studies with the study length shorter than 60 years")
pander(round(summary(model7)$s.table,2), caption = "Statistical summary of the smooth terms reducing dataset to studies with the study length shorter than 60 years")
#require(visreg)
png("model7_smooths.png", width = 2500, height = 1800, res = 300)
#par(mfrow=c(2,2))
D <- visreg(model7_nolongLength, "Dryness", gg = T, plot = T) + theme_bw()
#require(visreg)
png("model7_smooths.png", width = 2500, height = 1800, res = 300)
#par(mfrow=c(2,2))
D <- visreg(model7, "Dryness", gg = T, plot = T) + theme_bw()
A <- visreg(model7, "Area_km2", gg = T, plot = T) + theme_bw() + scale_x_log10()
L <- visreg(model7, "length", gg = T, plot = T) + theme_bw()
From <- visreg(model7, "From", gg = T, plot = T) + theme_bw()
(D + A) / (L + From)
# visreg(model6_all,"Dryness",gg=T) + theme_bw()
# visreg(model6_all,"length",gg=T, add=T) + theme_bw()
# visreg(model6_all,"Area_km2",gg=T, add=T) + theme_bw() + scale_x_log10()
#par(mfrow=c(1,1))
dev.off()
NoLong_Data <- All_data2 %>% filter(length< 60, Dryness <= 4)
model7 <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign +
s(Dryness, bs="ts" ) + #s(Latitude, bs="ts") +
s(log10(Area_km2), bs = "ts") + s(length, bs = "ts") + s(From, bs = "ts") +
Precip_data_type +  Assessment_technique + Forest_type +
Hydrological_regime, data = NoLong_Data)
summary(model7)
pander(round(summary(model7)$s.table,2), caption = "Statistical summary of the smooth terms reducing dataset to studies with the study length shorter than 60 years")
#require(visreg)
png("model7_smooths.png", width = 2500, height = 1800, res = 300)
#par(mfrow=c(2,2))
D <- visreg(model7, "Dryness", gg = T, plot = T) + theme_bw()
A <- visreg(model7, "Area_km2", gg = T, plot = T) + theme_bw() + scale_x_log10()
L <- visreg(model7, "length", gg = T, plot = T) + theme_bw()
From <- visreg(model7, "From", gg = T, plot = T) + theme_bw()
(D + A) / (L + From)
# visreg(model6_all,"Dryness",gg=T) + theme_bw()
# visreg(model6_all,"length",gg=T, add=T) + theme_bw()
# visreg(model6_all,"Area_km2",gg=T, add=T) + theme_bw() + scale_x_log10()
#par(mfrow=c(1,1))
dev.off()
summary(model8_assess)
model8_assess <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign +
s(Dryness, bs="ts" ) + #s(Latitude, bs="ts") +
log10(Area_km2) + log(length) + From +
Precip_data_type +  Assessment_technique + Forest_type +
Hydrological_regime, data = All_data3 %>% filter(length< 60))
model8_assess <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign +
s(Dryness, bs="ts" ) + #s(Latitude, bs="ts") +
log10(Area_km2) + log(length+1) + From +
Precip_data_type +  Assessment_technique + Forest_type +
Hydrological_regime, data = All_data3 %>% filter(length< 60))
summary(model8_assess)
pander(round(summary(model8_assess)$p.table,2), caption= "(\\#tab:model8-linear) Statistical overview of the linear components of the model removing studies with limited observations in the assessment techniques")
pander(round(summary(model8_assess)$s.table,2), caption = "(\\#tab:model8-smooth) Statistical overview of the smooth components of the model removing studies with limited observations in the assessment techniques")
All_data3 <- All_data2 %>%
filter(Assessment_technique != "EA, HM" & Assessment_technique != "PWE, HM" & Assessment_technique != "QPW, EA" )
model8_assess <- gam(DeltaQf_perc ~ DeltaF_perc_pos + Forest_Sign +
s(Dryness, bs="ts" ) + #s(Latitude, bs="ts") +
s(log10(Area_km2), bs = "ts") + s(length, bs = "ts") + s(From, bs = "ts") +
Precip_data_type +  Assessment_technique + Forest_type +
Hydrological_regime, data = All_data3 %>% filter(length< 60))
#plot(model8_assess)
#summary(model8_assess)
pander(round(summary(model8_assess)$p.table,2), caption= "(\\#tab:model8-linear) Statistical overview of the linear components of the model removing studies with limited observations in the assessment techniques")
pander(round(summary(model8_assess)$s.table,2), caption = "(\\#tab:model8-smooth) Statistical overview of the smooth components of the model removing studies with limited observations in the assessment techniques")
